# Telegram Notifyer


## Description

Этот небольшой проект разработан специально для запуска на микро хостинге, требуемый объем диска менее 10 Мб. Он позволяет развернуть бот для оповещения через Телеграм о поступлении новых заказов у продавца на OZON площадке. А так же мониторить статус "доступен"/"недоступен" для своих веб-сайтов.

Оповещение бот отправляет в привязанные групповые чаты. Привязка чатов происходит при добавлении бота как участника в группу.


## Installing

1. Скопировать весь проект в выбранную папку на веб-сайте.
2. Исполнить команду:
    ```bash
    $ composer update --no-dev
    ```
3. Скопировать файл **.htaccess.example** в **.htaccess** и отредактировать:
    - ROOT_URI  *папка к которой мы планируем обращаться через веб*
    - SITE_URI  *папка в которой находится проект (обычно = ROOT_URI)*
    - BOT_INTERNAL_ID  *номер бота в нашей базе*
    - BOT_HOST_ID  *номер хостинга (для мониторинга своих веб-сайтов)*
    - BOT_TOKEN  *API токен телеграм бота*
    - ADMIN_CHAT_ID  *API id админского чата*
    - CRYPTO_KEY  *1й набор символов для ключа шифрования*
    - CRYPTO_SALT  *2й набор символов для ключа шифрования*
    - RewriteBase  *должно быть = ROOT_URI*
4. В корне на хостинге создать файл **ini_h.php**
   ```php
    <?php
    define('DB_HOST', 'хостинг базы данных');
    define('DB_USER', 'имя пользователя базы данных');
    define('DB_PASS', 'пароль');
    define('DB_DB', 'имя базы');
   ```
5. Используя файл *./TNotifyer/Database/tables.sql* создать структуру базы данных.
6. Запустить на сайте */set-webhook*


## Configuration

1. Предоставить боту доступ до OZON API используя команды из админского чата:
    ```
    /ozon set id
    <CLIENT ID>
    /ozon set key
    <API KEY>
    ```
2. Для проверки заказов OZON создать на хостинге в планировщике задачу вида:
    ```bash
    wget -O /dev/null "<путь до сайта>/ozon"
    ```
3. Для проверки статуса веб-сайтов создать на хостинге в планировщике задачу вида:
    ```bash
    wget -O /dev/null "<путь до сайта>/ping-websites"
    ```


## Telegram Bot Commands

Команды доступные в Телеграм из админского чата.

1. **/info** - информация о приложении на хостинге
2. **/ozon** - информация об OZON аккаунте
3. **/ozon id** - отобразить установленный OZON CLIENT ID
4. **/ozon set id** - установить OZON CLIENT ID
5. **/ozon set key** - установить OZON API KEY
6. **/test** - отправить тестовое сообщение в привязанные чаты


## Site Commands

Команды доступные на сайте.

1. **/ozon** - проверка новых заказов на OZON
2. **/ping-websites** - проверка статуса веб-сайтов
3. **/watch-dog** - проверка активности бота
4. **/set-webhook** - привязка вебхука для бота
5. **/remove-webhook** - удаление привязки вебхука
6. **/up** - проверка API сообщений для бота (если нет привязанного вебхука)
7. **/info** - информация о приложении
8. **/bot-info** - информация о телеграм боте
9. **/ozon-info** - информация об OZON аккаунте
10. **/log** - отображение последних событий в приложении
11. **/last** - отображение последних заказов
12. **/updates** - отображение последних API сообщений для бота
13. **/test-msg** - отправка тестового сообщения в привязанные чаты
14. **/ozon-test** - тестовое обращение к списку заказов на OZON
15. **/crypto-test** - запуск теста для библиотеки шифрования
